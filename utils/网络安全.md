# 服务器攻击事件

服务器被恶意访问，删除数据库，停止docker并留下勒索信息

## 可能原因

ssh设置为默认端口22，且允许全网访问，mysql设置为默认端口3306，且允许全网访问

mysql密码过于简单且权限过高，被连接mysql后删除数据库并留下勒索信息以及停止docker

## 重装系统

### 账号信息

**华为云登录**
账号：18296837205
密码：yasuosjh521
**华为云服务器**
密码：GRANDcany0n@

### ssh配置

```shell
#ssh配置文件路径
/etc/ssh/sshd_config

#备份原配置文件
cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup

#禁止密码登录
PasswordAuthentication no

#开放密钥登录
PubkeyAuthentication yes

#ssh端口修改
Port 15964

#刷新ssh配置
systemctl restart sshd

#给用户配置密码
passwd canyon
```

### 普通用户

用户：canyon

密码：JUGKING123@

```shell
#添加用户
adduser canyon

#允许使用sudo
usermod -aG wheel canyon

#切换用户
su - canyon

#创建目录，如果没有父目录一起创建
mkdir -p /home/canyon/.ssh

#chmod 700 给予canyon 用户本人有读、写、执行权限
chmod 700 /home/canyon/.ssh

#给公钥设置权限，600 表示只能文件所有者可以读写，其他人无权访问
chmod 600 /home/canyon/.ssh/authorized_keys

#change own,改变拥有者
chown -R canyon:canyon /home/canyon/.ssh

#给root设置禁止登录 只允许用sudo
PermitRootLogin no
```

### Oh-My-zsh配置

```shell
#设置默认终端为 zsh（注意：不要使用 sudo）。
chsh -s /bin/zsh

#国内镜像
sh -c "$(wget -O- https://gitee.com/pocmon/ohmyzsh/raw/master/tools/install.sh)"

#安装插件
git clone https://github.moeyy.xyz/https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions

git clone https://gh.xmly.dev/https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting

#启动插件
vim ~/.zshrc
plugins=(git zsh-autosuggestions zsh-syntax-highlighting)

#重启配置
source ~/.zshrc
```

# DNS

## 问题

在没有经过修改的情况下通过`ssh`连接`github`出现问题

```shell
$ ssh -T git@github.com
ssh: Could not resolve hostname github.com: Temporary failure in name resolution
```

## 问题排查

问题首先排查`DNS`解析问题，一般来说是因为`github.com`域名没有正确的解析为`ip`地址所以报错

可能原因是校园网封锁了外网的域名解析

## 问题解决

将以太网的自动分配`DNS`改为`google`的`DNS:8.8.8.8`

## 善后

不建议将

```shell
ssh -T git@github.com
```

改为

```shell
ssh -T git@140.82.121.35#github的ip地址
```

因为客户端会认为在连接一个**全新的、从未访问过的主机**，如果下次 GitHub 的负载均衡器给你分配了另一个 IP（比如 `140.82.121.36`），连接又会失败，因为它又是一个“新主机”，指纹不匹配。

